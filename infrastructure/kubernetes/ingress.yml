apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: supplyboost-ingress
  namespace: supplyboost
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/limit-rps: "10"
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/enable-cors: "true"
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - supplyboost.example.com
      secretName: supplyboost-tls
  rules:
    - host: supplyboost.example.com
      http:
        paths:
          # Identity Service
          - path: /api/identity(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: identity-service
                port:
                  number: 8081

          # Product Catalog Service
          - path: /api/catalog(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: product-catalog-service
                port:
                  number: 8082

          # Shopping Cart Service
          - path: /api/cart(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: shopping-cart-service
                port:
                  number: 8083

          # Order Management Service
          - path: /api/orders(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: order-management-service
                port:
                  number: 8084

          # Inventory Service
          - path: /api/inventory(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: inventory-service
                port:
                  number: 8085

          # Payment Service
          - path: /api/payments(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: payment-service
                port:
                  number: 8086

          # Shipping Service
          - path: /api/shipping(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: shipping-service
                port:
                  number: 8087

          # Notification Service (typically internal only, but included for completeness)
          - path: /api/notifications(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: notification-service
                port:
                  number: 8088

          # Accounting Service
          - path: /api/accounting(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: accounting-service
                port:
                  number: 8089

          # Monitoring Endpoints
          - path: /grafana(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: grafana-service
                port:
                  number: 3000

          - path: /prometheus(/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: prometheus-service
                port:
                  number: 9090
